* make everything thread-safe
* optimize checkpointing (maybe multiple files?)
* add support for snapshoting
